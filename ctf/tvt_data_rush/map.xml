<map proto="1.5.0" game="Flag Assault &amp; Blitz">
<name>TVT: Data Rush</name>
<version>1.0.1</version>
<phase>development</phase>
<objective>Score your flag in the enemy goals, last team standing wins!</objective>
<created>2025-11-15</created>
<gamemode>ctf</gamemode>
<include id="gapple-kill-reward"/>
<constants>
    <constant id="team-size">12</constant>
    <constant id="starting-score">6</constant> <!--starting hearts for each team-->
    <constant id="score-ammount">-1</constant> <!--how many hearts to deduct for a sucessful score-->
    <constant id="recover-time">15s</constant> <!--flag recovery time -->
    <constant id="respawn-time">7s</constant> <!--flag respawn time -->
</constants>
<authors>
    <author uuid="1aad55f7-2dea-4f22-85ca-ad9de3a78609" contribution="Map Author"/> <!-- Technodono -->
</authors>
<contributors>
    <contributor uuid="9602cd49-4779-4965-846f-67d49bce48a8" contribution="Map Layout"/> <!-- Abuelos -->
</contributors>
<rules>
    <rule>Fall damage is disabled!</rule>
    <rule>No camping with any of the flags!</rule>
    <rule>No intentional crossteaming allowed!</rule>
</rules>
<broadcasts>
    <tip after="1s" every="2m">Remember to defend your teams goals from the enemy flag carrier!</tip>
</broadcasts>
<!--  Teams and Kits  -->
<teams>
    <team id="red-team" color="red" max="${team-size}">Red</team>
    <team id="yellow-team" color="yellow" max="${team-size}">Yellow</team>
    <team id="green-team" color="green" max="${team-size}">Green</team>
    <team id="blue-team" color="blue" max="${team-size}">Blue</team>
</teams>
<kits>
    <kit id="spawn-kit">
        <clear/>
        <item slot="0" unbreakable="true" material="stone sword"/>
        <item slot="1" unbreakable="true" material="gold axe"/>
        <item slot="2" unbreakable="true" enchantment="infinity" material="bow"/>
        <item slot="3" amount="6" projectile="arrow" name="`rCrossbow" lore="`r`7Right-click to fire!" material="firework charge"/>
        <item slot="4" amount="64" damage="3" material="leaves"/>
        <item slot="5" amount="24" material="wood"/>
        <item slot="6" material="golden apple"/>
        <item slot="27" material="arrow"/>
        <leggings unbreakable="true" locked="true" material="chainmail leggings">
            <enchantment level="2">projectile_protection</enchantment>
        </leggings>
        <boots unbreakable="true" locked="true" material="iron boots"/>
        <potion duration="2" amplifier="10">regeneration</potion>
        <potion duration="2" amplifier="10">damage_resistance</potion>
        <game-mode>survival</game-mode>
        <helmet team-color="true" locked="true" unbreakable="true" material="leather helmet"/>
        <chestplate team-color="true" locked="true" unbreakable="true" material="leather chestplate"/>
    </kit>
    <kit id="flag-pickup" force="true">
        <max-health>10</max-health>
    </kit>
    <kit id="reset-health" force="true">
        <max-health>20</max-health>
    </kit>
</kits>
<!--  Spawns and respawns  -->
<spawns>
    <spawn team="red-team" kit="spawn-kit" yaw="-90">
        <region>
            <point id="red-spawnpoint">-53.5,8,-53.5</point>
        </region>
    </spawn>
    <spawn team="yellow-team" kit="spawn-kit" yaw="0">
        <region>
            <point id="yellow-spawnpoint">54.5,8,-53.5</point>
        </region>
    </spawn>
    <spawn team="green-team" kit="spawn-kit" yaw="90">
        <region>
            <point id="green-spawnpoint">54.5,8,54.5</point>
        </region>
    </spawn>
    <spawn team="blue-team" kit="spawn-kit" yaw="180">
        <region>
            <point id="blue-spawnpoint">-53.5,8,54.5</point>
        </region>
    </spawn>
    <default yaw="90">
        <region>
            <cuboid min="4,58,4" max="-1,58,-3"/>
        </region>
    </default>
</spawns>
<projectiles>
    <projectile id="arrow" name="crossbow bolt" velocity="4" damage="7" throwable="true" cooldown="2.5s"/>
</projectiles>
<!-- spawn region stuff  -->
<variables>
    <score id="team_lives"/>
    <with-team id="red_team_lives" var="team_lives" team="red-team"/>
    <with-team id="yellow_team_lives" var="team_lives" team="yellow-team"/>
    <with-team id="green_team_lives" var="team_lives" team="green-team"/>
    <with-team id="blue_team_lives" var="team_lives" team="blue-team"/>
    <variable id="blitz_enabled" scope="match">0</variable>
    <variable id="team_kill" scope="team">0</variable>
</variables>
<!--  Filters  -->
<filters>
    <team id="team-red">red-team</team>
    <team id="team-yellow">yellow-team</team>
    <team id="team-green">green-team</team>
    <team id="team-blue">blue-team</team>
    <variable id="red-team-one-life" var="red_team_lives">1</variable>
    <variable id="yellow-team-one-life" var="yellow_team_lives">1</variable>
    <variable id="green-team-one-life" var="green_team_lives">1</variable>
    <variable id="blue-team-one-life" var="blue_team_lives">1</variable>
    <variable id="team-alive" var="team_lives">[1,oo]</variable>
    <variable id="red-team-alive" var="red_team_lives">[1,oo]</variable>
    <variable id="yellow-team-alive" var="yellow_team_lives">[1,oo]</variable>
    <variable id="green-team-alive" var="green_team_lives">[1,oo]</variable>
    <variable id="blue-team-alive" var="blue_team_lives">[1,oo]</variable>
    <players id="can-score-red-portal" filter="all(match-running, alive, not(team-red), red-portal, has-any-flag)"/>
    <players id="can-score-yellow-portal" filter="all(match-running, alive, not(team-yellow), yellow-portal, has-any-flag)"/>
    <players id="can-score-green-portal" filter="all(match-running, alive, not(team-green), green-portal, has-any-flag)"/>
    <players id="can-score-blue-portal" filter="all(match-running, alive, not(team-blue), blue-portal, has-any-flag)"/>

    <any id="has-any-flag">
        <carrying-flag>red-flag-1</carrying-flag>
        <carrying-flag>red-flag-2</carrying-flag>
        <carrying-flag>yellow-flag-1</carrying-flag>
        <carrying-flag>yellow-flag-2</carrying-flag>
        <carrying-flag>green-flag-1</carrying-flag>
        <carrying-flag>green-flag-2</carrying-flag>
        <carrying-flag>blue-flag-1</carrying-flag>
        <carrying-flag>blue-flag-2</carrying-flag>
    </any>
    <not id="blitz-disabled">
        <variable id="blitz-enabled" var="blitz_enabled">1</variable>
    </not>
    <deny id="deny-use">
        <any>
            <material>spruce_fence_gate</material>
            <material>birch_fence_gate</material>
            <material>jungle_fence_gate</material>
            <material>dark_oak_fence_gate</material>
            <material>acacia_fence_gate</material>
            <material>dropper</material>
            <material>dispenser</material>
            <material>note_block</material>
            <material>furnace</material>
        </any>
    </deny>
    <any id="legal-blocks">
        <material>fence</material>
        <material>workbench</material>
        <material>wood_button</material>
        <material>leaves</material>
        <material>wood_plate</material>
        <material>fence_gate</material>
        <material>wooden_door</material>
        <material>wood:0</material>
        <material>wood_step:0</material>
        <material>wood_double_step:0</material>
        <material>wood_stairs:0</material>
        <material>ladder</material>
        <material>chest</material>
        <material>tnt</material>
    </any>
    <deny id="redstone-blocks-fixed">
        <all>
            <cause>player</cause>
            <not>
                <material>tnt</material>
            </not>
        </all>
    </deny>
    <any id="is-in-valid-portal">
        <all>
            <region id="red-portal"/>
            <filter id="red-team-alive"/>
        </all>
        <all>
            <region id="yellow-portal"/>
            <filter id="yellow-team-alive"/>
        </all>
        <all>
            <region id="green-portal"/>
            <filter id="green-team-alive"/>
        </all>
        <all>
            <region id="blue-portal"/>
            <filter id="blue-team-alive"/>
        </all>
    </any>
</filters>
<actions>
    <trigger filter="always" scope="match">
        <action>
            <switch-scope inner="team" observers="true">
                <action id="team_lives := (${starting-score})" />
            </switch-scope>
        </action>
    </trigger>
    <action id="force-kill-team" scope="team" expose="true">
        <action id="team_lives := 0"/>
    </action>
    <trigger scope="team" action="notify-team">
        <filter><score>5</score></filter>
    </trigger>
    <trigger scope="team" action="notify-team">
        <filter><score>4</score></filter>
    </trigger>
    <trigger scope="team" action="notify-team">
        <filter><score>3</score></filter>
    </trigger>
    <trigger scope="team" action="notify-team">
        <filter><score>2</score></filter>
    </trigger>
    <trigger scope="team" action="notify-team">
        <filter><score>1</score></filter>
    </trigger>
    <trigger scope="team" action="teleport-team">
        <filter><score>0</score></filter>
    </trigger>
    <trigger scope="team" action="kill-team">
        <filter><after duration="3s" message="Returning to OBS in: {0}"><score>0</score></after></filter>
    </trigger>
     <!-- Automatically updates to show time -->
    
    <action id="notify-team" scope="team">
        <sound key="mob.enderdragon.hit" pitch="1" volume="2"/>
        <sound key="mob.wither.hurt" pitch="0.75" volume="0.3"/>
        <action filter="score = 1">
            <message title="`d`lOne Life Remaining!"/>
        </action>
    </action>
    
    <action id="teleport-team" scope="team">
        <sound key="mob.enderdragon.hit" pitch="1" volume="2"/>
        <sound key="mob.wither.spawn" preset="OBJECTIVE_BAD"/>
        <message title="`c`lTeam Eliminated!"/>
        <set var="team_kill" value="1"/>
        <set var="blitz_enabled" value="1"/>
        <switch-scope inner="player">
            <action filter="team-red">
                <teleport x="-53.5" y="8" z="-53.5" yaw="-90"/>
            </action>
            <action filter="team-yellow">
                <teleport x="54.5" y="8" z="-53.5" yaw="0"/>
            </action>
            <action filter="team-green">
                <teleport x="54.5" y="8" z="54.5" yaw="90"/>
            </action>
            <action filter="team-blue">
                <teleport x="-53.5" y="8" z="54.5" yaw="180"/>
            </action>
        </switch-scope>
   
        <action filter="team-red">
            <switch-scope inner="match">
                <fill region="red-spawnroom-door" material="stained clay:14"/>
                <fill region="red-portal" material="air"/>
                <fill region="red-objective-sign" material="air"/>
            </switch-scope>
        </action>
        <action filter="team-yellow">
            <switch-scope inner="match">
                <fill region="yellow-spawnroom-door" material="stained clay:1"/>
                <fill region="yellow-portal" material="air"/>
                <fill region="yellow-objective-sign" material="air"/>
            </switch-scope>
        </action>
        <action filter="team-green">
            <switch-scope inner="match">
                <fill region="green-spawnroom-door" material="stained clay:13"/>
                <fill region="green-portal" material="air"/>
                <fill region="green-objective-sign" material="air"/>
            </switch-scope>
        </action>
        <action filter="team-blue">
            <switch-scope inner="match">
                <fill region="blue-spawnroom-door" material="stained clay:11"/>
                <fill region="blue-portal" material="air"/>
                <fill region="blue-objective-sign" material="air"/>
            </switch-scope>
        </action>

    </action>

    <action id="kill-team" scope="team">
        <team-alias alias="-----"/>
        <message text="`8`l──────────────────"/>
        <action filter="team-red">
            <message text="`c✘ `7[`4Red Team`7 Has Been Eliminated]"/>
        </action>
        <action filter="team-yellow">
            <message text="`c✘ `7[`eYellow Team`7 Has Been Eliminated]"/>
        </action>
        <action filter="team-green">
            <message text="`c✘ `7[`aGreen Team`7 Has Been Eliminated]"/>
        </action>
        <action filter="team-blue">
            <message text="`c✘ `7[`9Blue Team`7 Has Been Eliminated]"/>
        </action>
        <message text="`8`l──────────────────"/>
        <!--send players to observers-->
        <switch-scope inner="player">
            <teleport x="0.5" y="58" z="0.5" yaw="90"/>
            <kit id="join-obs">
                <effect duration="2" amplifier="100">instant_damage</effect>
            </kit>
        </switch-scope>
    </action>

</actions>
<regions>
    <apply block="never" region="team-spawnrooms"/>

    <apply enter="deny(team-red)" region="red-portal" message="Cannot score in your own goal!"/>
    <apply enter="deny(team-yellow)" region="yellow-portal" message="Cannot score in your own goal!"/>
    <apply enter="deny(team-green)" region="green-portal" message="Cannot score in your own goal!"/>
    <apply enter="deny(team-blue)"  region="blue-portal" message="Cannot score in your own goal!"/>

    <apply enter="red-team-alive" block-place="never" region="red-portal" message="This goal is already destroyed!"/>
    <apply enter="yellow-team-alive" block-place="never" region="yellow-portal" message="This goal is already destroyed!"/>
    <apply enter="green-team-alive" block-place="never" region="green-portal" message="This goal is already destroyed!"/>
    <apply enter="blue-team-alive" block-place="never" region="blue-portal" message="This goal is already destroyed!"/>
 
    <apply enter="deny(not(team-red))" region="red-spawnroom" message="Cannot enter another team's spawn!"/>
    <apply enter="deny(not(team-yellow))" region="yellow-spawnroom" message="Cannot enter another team's spawn!"/>
    <apply enter="deny(not(team-green))" region="green-spawnroom" message="Cannot enter another team's spawn!"/>
    <apply enter="deny(not(team-blue))" region="blue-spawnroom" message="Cannot enter another team's spawn!"/>
    <apply block="never" region="flag-posts" message="You may not modify the flag posts!"/>
    <apply block="never" region="spawners" message="You may not modify the item spawners!"/>
    <apply block="deny(void)" message="You may not modify the void area!"/>
    <apply block-place="redstone-blocks-fixed" message="You may only place TNT here!">
        <region>
            <above y="20"/>
        </region>
    </apply>
    <apply block="legal-blocks" use="deny-use"/>


    <!-- Enter -->
    
    <!-- Apply Kits -->
    <apply kit="spawn-kit" region="red-portal" filter="not(team-red)"/>
    <apply kit="spawn-kit" region="yellow-portal" filter="not(team-yellow)"/>
    <apply kit="spawn-kit" region="green-portal" filter="not(team-green)"/>
    <apply kit="spawn-kit" region="blue-portal" filter="not(team-blue)"/>
    <!--  Goal regions  -->
    <union id="all-portals">
        <cuboid id="red-portal" min="-53,8,-37" size="1,6,-5"/>
        <cuboid id="yellow-portal" min="38,8,-53" size="5,6,1"/>
        <cuboid id="green-portal" min="54,8,38" size="-1,6,5"/>
        <cuboid id="blue-portal" min="-37,8,54" size="-5,6,-1"/>
    </union>

    <translate id="red-objective-sign" offset="-1,17,0" region="red-portal"/>
    <translate id="yellow-objective-sign" offset="0,17,-1" region="yellow-portal"/>
    <translate id="green-objective-sign" offset="1,17,0" region="green-portal"/>
    <translate id="blue-objective-sign" offset="0,17,1" region="blue-portal"/>


    <cuboid id="mid-room" min="-15,0,15" max="16,20,-15"/>
    <block id="mid-spawner-spawning">0,10,0</block>
    <union id="spawners">
        <cuboid id="mid-spawner" min="-1,9,-1" size="3,2,3"/>
        <cuboid id="red-blue-spawner" min="-56,8,0" size="1,2,1"/> <!--blue-red-->
        <mirror normal="1,0,1" origin="0.5,0,0.5" region="red-blue-spawner" id="spawner2"/> <!--blue-green-->
        <mirror normal="1,0,0" origin="0.5,0,0.5" region="red-blue-spawner" id="spawner3"/> <!--green-yellow-->
        <mirror normal="1,0,-1" origin="0.5,0,0.5" region="red-blue-spawner" id="spawner4"/> <!--yellow-red-->
    </union>
    <union id="flag-posts">
        <cuboid id="red-post" min="-45,8,-48" size="5,5,3"/>
        <cuboid id="blue-post" min="-48,8,46" size="3,5,-5"/>
        <mirror normal="1,0,0" origin="0.5,0,0.5">
            <mirror normal="0,0,1" origin="0.5,0,0.5" region="red-post"/> <!--green post-->
        </mirror>
        <mirror normal="1,0,0" origin="0.5,0,0.5">
            <mirror normal="0,0,1" origin="0.5,0,0.5" region="blue-post"/> <!--yellow post-->
        </mirror>
    </union>
    <union id="team-spawnrooms">
        <cuboid id="red-spawnroom" min="-56,0,-57" size="24,19,7"/>
        <cuboid id="yellow-spawnroom" min="58,0,-56" size="-7,19,24"/>
        <cuboid id="green-spawnroom" min="57,0,58" size="-24,19,-7"/>
        <cuboid id="blue-spawnroom" min="-57,0,57" size="7,19,-24"/>
    </union>
    <union id="team-spawnroom-doors">
        <cuboid id="red-spawnroom-door" min="-33,14,-51" size="-5,4,1"/>
        <cuboid id="yellow-spawnroom-door" min="52,14,-33" size="-1,4,-5"/>
        <cuboid id="green-spawnroom-door" min="34,14,52" size="5,4,-1"/>
        <cuboid id="blue-spawnroom-door" min="-51,14,34" size="1,4,5"/>
    </union>
</regions>
<portals>
    <!-- portals to spawn -->
    <portal forward="all(all-portals,team-red)" filter="is-in-valid-portal" destination="red-spawnpoint"/>
    <portal forward="all(all-portals,team-blue)" filter="is-in-valid-portal" destination="blue-spawnpoint"/>
    <portal forward="all(all-portals,team-green)" filter="is-in-valid-portal" destination="green-spawnpoint"/>
    <portal forward="all(all-portals,team-yellow)" filter="is-in-valid-portal" destination="yellow-spawnpoint"/>
</portals>
<spawners>
    <spawner spawn-region="mid-spawner-spawning" player-region="mid-room" max-entities="1" delay="15s">
        <item amount="1" material="golden apple"/>
    </spawner>
    <spawner spawn-region="red-blue-spawner" player-region="everywhere" max-entities="1" delay="25s">
        <item amount="1" material="tnt"/>
    </spawner>
    <spawner spawn-region="spawner2" player-region="everywhere" max-entities="1" delay="25s">
        <item amount="1" material="tnt"/>
    </spawner>
    <spawner spawn-region="spawner3" player-region="everywhere" max-entities="1" delay="25s">
        <item amount="1" material="tnt"/>
    </spawner>
    <spawner spawn-region="spawner4" player-region="everywhere" max-entities="1" delay="25s">
        <item amount="1" material="tnt"/>
</spawner>
</spawners>
<!-- Tools and Misc item stuff -->
<toolrepair>
    <tool>stone sword</tool>
    <tool>gold axe</tool>
    <tool>bow</tool>
</toolrepair>
<itemremove>
    <item>banner</item>
    <item>leather helmet</item>
    <item>chainmail leggings</item>
    <item>iron boots</item>
    <item>leather chestplate</item>
    <item>arrow</item>
</itemremove>
<itemkeep>
    <item>wood</item>
    <item>leaves</item>
    <item>golden apple</item>
    <item>firework charge</item>
    <item>wood sword</item>
    <item>wood axe</item>
    <item>wood pickaxe</item>
    <item>wood hoe</item>
    <item>wood spade</item>
</itemkeep>
<!-- Disable fall damage -->
<disabledamage>
    <damage>fall</damage>
</disabledamage>
<hunger>
    <depletion>off</depletion>
</hunger>
<world>
    <timelock>on</timelock>
    <timeset>1200</timeset>
</world>
<maxbuildheight>30</maxbuildheight>
<!-- Goal and Flag settings -->
<kill-rewards>
    <kill-reward>
        <item amount="3" projectile="arrow" name="`rCrossbow" lore="`r`7Right-click to fire!" material="firework charge"/>
        <item amount="16" material="leaves" damage="3"/>
        <item amount="8" material="wood"/>
    </kill-reward>
</kill-rewards>
<score display="heart"/>
<blitz>
    <lives>1</lives>
    <broadcastLives>false</broadcastLives>
    <join-filter><filter id="blitz-disabled"/></join-filter>
    <filter><variable var="team_kill">1</variable></filter>
</blitz>
<time>10m</time>
<respawn auto="true"/>
<tnt>
    <instantignite>on</instantignite>
    <fuse>2s</fuse>
</tnt>
<flags show-sidebar="false" required="false" stats="false" carry-message="Score this in the enemy's goals!" pickup-kit="flag-pickup" drop-kit="reset-health">
    <flag id="red-flag-1" name="Red Flag" color="red" pickup-filter="team-red">
        <post recover-time="${recover-time}" respawn-time="${respawn-time}" yaw="0">-42,8,-47</post>
    </flag>
    <flag id="red-flag-2" name="Red Flag II" color="red" pickup-filter="team-red">
        <post recover-time="${recover-time}" respawn-time="${respawn-time}" yaw="0">-44, 8, -47</post>
    </flag>
    <flag id="yellow-flag-1" name="Yellow Flag" color="yellow" pickup-filter="team-yellow">
        <post recover-time="${recover-time}" respawn-time="${respawn-time}" yaw="90">47, 8, -44</post>
    </flag>
    <flag id="yellow-flag-2" name="Yellow Flag II" color="yellow" pickup-filter="team-yellow">
        <post recover-time="${recover-time}" respawn-time="${respawn-time}" yaw="90">47, 8, -42</post>
    </flag>
    <flag id="green-flag-1" name="Green Flag" color="green" pickup-filter="team-green">
        <post recover-time="${recover-time}" respawn-time="${respawn-time}" yaw="180">44, 8, 47</post>
    </flag>
    <flag id="green-flag-2" name="Green Flag II" color="green" pickup-filter="team-green">
        <post recover-time="${recover-time}" respawn-time="${respawn-time}" yaw="180">42, 8, 47</post>
    </flag>
    <flag id="blue-flag-1" name="Blue Flag" color="blue" pickup-filter="team-blue">
        <post recover-time="${recover-time}" respawn-time="${respawn-time}" yaw="-90">-47, 8, 44</post>
    </flag>
    <flag id="blue-flag-2" name="Blue Flag II" color="blue" pickup-filter="team-blue">
        <post recover-time="${recover-time}" respawn-time="${respawn-time}" yaw="-90">-47, 8, 42</post>
    </flag>
    <flags points="${score-ammount}">
        <net owner="red-team" region="red-portal" capture-filter="all(not(red-team),red-team-alive)" />
        <net owner="blue-team" region="blue-portal" capture-filter="all(not(blue-team),blue-team-alive)"/>
        <net owner="yellow-team" region="yellow-portal" capture-filter="all(not(yellow-team),yellow-team-alive)"/>
        <net owner="green-team" region="green-portal" capture-filter="all(not(green-team),green-team-alive)"/>
    </flags>
</flags>
</map>
