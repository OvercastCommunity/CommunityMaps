<map proto="1.5.0">
<name>Hide &amp; Seek: US STATES</name>
<version>1.0.0</version>
<objective>Hide from the seekers before the time runs out!</objective>
<authors>
    <author uuid="d5a64b26-15ea-46c4-8319-f9c83e82a1fa" contribution="Organizer. Arkansas, Hawaii, US Virgin Islands, New Jersey, New Mexico, Tennessee" /> <!-- Eliminate -->
    <author uuid="2751fbd5-bb78-4633-be5c-ea1c804df25b" contribution="Alabama" /> <!-- dsr12 -->
    <author uuid="f610e558-a3c8-44fb-8622-68cc49dbc18f" contribution="Alaska" /> <!-- jcane -->
    <author uuid="cc2292de-fcb3-412d-9319-f3177f73b605" contribution="Arizona, Colorado" /> <!-- cs_ -->
    <author uuid="ed9938e6-3b44-4149-88d9-dfa03e733008" contribution="California, New Hampshire, Wyoming" /> <!-- justTNT__ -->
    <author uuid="5b97747b-90ce-49b5-896c-2a6b066b753a" contribution="Connecticut" /> <!-- poopypeggy -->
    <author uuid="c33a03bf-0f73-46e2-a93e-ddb7d25232d1" contribution="Delaware, Pennsylvania" /> <!-- Teheggi -->
    <author uuid="d1c4b70c-e4df-4ed6-999a-2e959bdfdac7" contribution="Florida" /> <!-- HUDV -->
    <author uuid="57c4813e-ecc2-4aee-9479-8d58991d1a0c" contribution="Georgia" /> <!-- CincoDeMayo -->
    <author uuid="c7883e78-7a1d-4149-a516-0d40bd26536a" contribution="Idaho, Oklahoma, Washington, West Virginia" /> <!-- bunbunbui -->
    <author uuid="53c7e46f-092a-4fc6-9721-54e60a97f09f" contribution="Illinois" /> <!-- FiIshywishi -->
    <author uuid="cc0108c5-07e8-436a-876e-ef82b692c91d" contribution="Indiana" /> <!-- GoReds99 -->
    <author uuid="4011d739-4dfb-41f6-8e60-5179d035cab7" contribution="Iowa, New York" /> <!-- MishM0sh -->
    <author uuid="644521d7-9437-47c1-b1d2-698eb757df3d" contribution="Kansas" /> <!-- minuyo -->
    <author uuid="e93cea5b-cb30-4573-9b52-14b3a9a7df69" contribution="Kentucky" /> <!-- obcursus -->
    <author uuid="b390b87a-47e8-40d8-968a-9e7e2582a88b" contribution="Lousiana" /> <!-- MewTwoKing -->
    <author uuid="55cb168a-e28f-49e5-a853-8268093926c8" contribution="Maine" /> <!-- 0uzi -->
    <author uuid="27ea204b-440f-4f5e-bd12-4e21777ffa37" contribution="Maryland, Massachusetts" /> <!-- MagiG67 -->
    <author uuid="bad165bd-458b-412e-b2a0-232a5b21f765" contribution="Michigan" /> <!-- Soleclaw -->
    <author uuid="c7f3434d-3a1c-4f49-8a67-914034f0117e" contribution="Minnesota" /> <!-- Masspec -->
    <author uuid="c25a6f7b-4c42-40da-8cd6-add53f0c84eb" contribution="Mississippi, Guam" /> <!-- arcadeboss -->
    <author uuid="9d4779a8-d35f-45d2-b51c-95de7a77e128" contribution="American Samoa, Northern Mariana Islands" /> <!-- zzuf -->
    <author uuid="38ef938a-7020-4c04-9d12-4875ed0598ca" contribution="Puerto Rico, Missouri" /> <!-- Kazoha -->
    <author uuid="654a9fe7-c75c-4b45-91df-8d48c4a5e072" contribution="Montana" /> <!-- Flamiix -->
    <author uuid="23386235-cf5f-435f-a326-af18064cd859" contribution="Nebraska" /> <!-- ZazSsav -->
    <author uuid="f34625ab-8f27-4cb5-8424-671fa82d4033" contribution="Nevada" /> <!-- Nidho0gg -->
    <author uuid="fa6c7968-06a6-4664-b715-26cf94db3a38" contribution="North Carolina" /> <!-- RHCube -->
    <author uuid="6d5ed40e-0297-42d0-a7d7-b2a4e978e622" contribution="North Dakota" /> <!-- EllisTea -->
    <author uuid="f8753ae6-a7ed-4d88-8d6d-537a5b1687e4" contribution="Ohio" /> <!-- guini2 -->
    <author uuid="a1e6faac-7bfa-4f5c-b5df-06942518d218" contribution="Oregon" /> <!-- EpicPuppy613 -->
    <author uuid="f6a51ada-db8f-49f8-9c31-e33bf474b542" contribution="Rhode Island, Utah" /> <!-- Frapuccino -->
    <author uuid="6ff4ade9-e968-4acd-80eb-1a6fa89629fb" contribution="South Carolina" /> <!-- _Pear -->
    <author uuid="69803996-1115-414c-b698-5986535f02b4" contribution="South Dakota" /> <!-- miniature_joe -->
    <author uuid="24dbb8b8-e961-43a3-8fe3-fb63e72f07b4" contribution="Texas" /> <!-- xRob3 -->
    <author uuid="ec5e1feb-ba5b-4f42-8493-af59989b2bce" contribution="Vermont" /> <!-- GrapeLime -->
    <author uuid="bf79899a-a06a-4506-8d18-3409ff39249a" contribution="Virginia" /> <!-- ___gavin -->
    <author uuid="e48801df-b259-4dd9-9d73-18f0698d2707" contribution="Wisconsin" /> <!-- MELS2315202321 -->
    <author uuid="64e840c8-4fb5-4659-a36b-ff93e2f6113a" contribution="Schizo XML" /> <!-- Javg_ -->
</authors>
<rules>
    <rule>Fall damage is disabled</rule>
    <rule>Name tags of hiders are not visible</rule>
    <rule>Seekers have Speed I</rule>
</rules>
<teams>
    <team id="hiders" color="green" show-name-tags="false" max="56" plural="true">Hiders</team>
    <team id="seekers" color="dark aqua" max="6" plural="true">Seekers</team>
</teams>
<blitz filter="hiders" join-filter="not(seekers-release)"/>
<time result="hiders">7m</time>
<kits>
    <kit id="seekers-kit">
        <kit filter="not(seekers-release)">
            <effect duration="26s">blindness</effect>
        </kit>
        <clear effects="true"/>
        <game-mode>adventure</game-mode>
        <item slot="0" material="iron sword" unbreakable="true" locked="true"/>
        <helmet unbreakable="true" material="diamond helmet" locked="true"/>
        <chestplate unbreakable="true" material="diamond chestplate" locked="true"/>
        <leggings unbreakable="true" material="diamond leggings" locked="true"/>
        <boots unbreakable="true" material="diamond boots" locked="true">
            <enchantment level="2">feather_falling</enchantment>
        </boots>
    </kit>
    <kit id="hiders-kit">
        <game-mode>adventure</game-mode>
        <item slot="0" material="compass" locked="true"/>
        <item material="potion" name="`rPotion of Invisibility `7(15s)">
            <effect duration="15s">invisibility</effect>
        </item>
    </kit>
    <kit id="invis-kit" deduct-items="false">
        <item material="potion" name="`rPotion of Invisibility `7(15s)">
            <effect duration="15s">invisibility</effect>
        </item>
    </kit>
    <give kit="invis-kit" filter="all(hiders,any(round_count=2,round_count=4,round_count=6,round_count=8))" />
</kits>
<spawns>
    <spawn team="hiders" kit="hiders-kit" yaw="0">
        <region>
            <point id="hiders-spawn-point">0.5,30,0.5</point>
        </region>
    </spawn>
    <spawn team="seekers" kit="seekers-kit" yaw="0">
        <region>
            <point id="seekers-spawn-point">0.5,32,-0.5</point>
        </region>
    </spawn>
    <default yaw="-180">
        <region>
            <point>0.5,87,74.5</point>            
        </region>
    </default>
</spawns>
<regions>
    <cuboid id="seeker-cage" min="-1,31,-2" max="2,35,1"/>
</regions>
<filters>
    <entity id="dropped-item">dropped item</entity>
    <after id="seekers-release" duration="25s" filter="match-started" message="`3`lSeekers`r will be released in {0}" />
</filters>
<variables>
    <!-- Schizo stuff -->
    <array id="pivot" size="2" scope="match" />
    <array id="min_xz" size="112" scope="match" />
    <array id="max_xz" size="112" scope="match" />
    <array id="size" size="2" scope="match" />
    <array id="destroyed_plots" size="56" scope="match" />
    <variable id="center" default="24" scope="match" />
    <variable id="i" scope="match" />
    <variable id="j" scope="match" />
    <variable id="p" scope="match" />
    <variable id="calc" scope="match" />
    <variable id="step" scope="match" />
    <cuboid id="to_delete" min="0,22,0" max="1,130,1" />
    <!-- debug -->
    <variable id="show_messages" scope="match" default="1"/>  <!-- Show larp messages when plots clear when var=1 -->
    <!-- rounds -->
    <variable id="round_count" default="1" scope="match" />
    <variable id="round_tracker" scope="match" />  <!-- Detect when rounds should be cleared -->
</variables>
<actions>
    <action id="cage-clearer" scope="match" expose="true">
        <fill region="seeker-cage" material="air" />
    </action>
    <trigger filter="seekers-release" action="cage-clearer" scope="match"/>
    <!-- why use regions when you can spend 100x more time and figure out a way to calculate every plot based on an initial coordinate? -->
    <!-- calculate plot positions -->
    <trigger scope="match" filter="always">
        <action>
            <set var="pivot" index="0" value="-54" />
            <set var="pivot" index="1" value="-54" />
            <set var="i" value="0" />
            <set var="p" value="0" />
            <repeat times="8">
                    <set var="j" value="0" />
                    <repeat times="8">
                        <action filter="not(any(all(j=7,i=0..6),all(j=6,i=4)))">
                            <set var="calc" value="p/2" />
                            <set var="size" index="0" value="11" />
                            <set var="size" index="1" value="11" />
                            <set var="step" value="14" />
                            <action filter="calc=30">
                                <set var="step" value="42" />
                            </action>
                            <action filter="any(calc=3,calc=10,calc=17,calc=37,calc=44)">
                                <set var="size" index="0" value="25" />
                                <set var="size" index="1" value="11" />
                                <set var="step" value="28" />
                            </action>
                            <action filter="calc=24">
                                <set var="size" index="0" value="25" />
                                <set var="size" index="1" value="25" />
                                <set var="step" value="28" />
                            </action>
                            <set var="min_xz" index="p" value="pivot[0]" />
                            <set var="min_xz" index="p + 1" value="pivot[1]" />
                            <set var="max_xz" index="p" value="pivot[0] + size[0]" />
                            <set var="max_xz" index="p + 1" value="pivot[1] + size[1]" />
                            <set var="pivot" index="0" value="pivot[0] + step" />
                            <set var="j" value="j+1" />    
                            <set var="p" value="p+2" />
                        </action>
                    </repeat>
                    <set var="pivot" index="0" value="min_xz[0]" />
                    <set var="pivot" index="1" value="pivot[1] + 14" />
                    <set var="i" value="i+1" />
            </repeat>
        </action>
    </trigger>
    <!-- clear states every round -->
    <trigger scope="match">
        <filter>
            <after id="destroy-filter" duration="10s" message="7 States disappearing in {0}">
                <after duration="48s" filter="all(round_tracker=0,match-running)" />
            </after>
        </filter>
        <action id="destroy" expose="true" scope="match">
            <set var="i" value="0" />
            <repeat times="10000" filter="i=0..6">
                <set var="j" value="floor(random() * 56)" />
                <action filter="not(destroyed_plots[j]=1)">
                    <set var="to_delete" index="0" value="min_xz[j*2]" />
                    <set var="to_delete" index="2" value="min_xz[j*2+1]" />
                    <set var="to_delete" index="3" value="max_xz[j*2]" />
                    <set var="to_delete" index="5" value="max_xz[j*2+1]" />
                    <fill region="to_delete" material="air" />
                    <action id="clear-state-message" />
                    <set var="destroyed_plots" index="j" value="1" />
                    <set var="i" value="i+1" />
                </action>
            </repeat>
        </action>
    </trigger>
    <!-- clear message -->
    <action id="clear-state-message" scope="match" filter="show_messages=1">
        <message text="{msg}">
            <replacements>
                <switch id="msg" value="j">
                    <case match="0" result="Alabama"/>
                    <case match="1" result="Florida"/>
                    <case match="2" result="Kentucky"/>
                    <case match="3" result="American Samoa"/>
                    <case match="4" result="Nebraska"/>
                    <case match="5" result="Ohio"/>
                    <case match="6" result="Texas"/>
                    <case match="7" result="Alaska"/>
                    <case match="8" result="Georgia"/>
                    <case match="9" result="Louisiana"/>
                    <case match="10" result="Guam"/>
                    <case match="11" result="Nevada"/>
                    <case match="12" result="Oklahoma"/>
                    <case match="13" result="Utah"/>
                    <case match="14" result="Arizona"/>
                    <case match="15" result="Hawaii"/>
                    <case match="16" result="Maine"/>
                    <case match="17" result="Northern Mariana Islands"/>
                    <case match="18" result="New Hampshire"/>
                    <case match="19" result="Oregon"/>
                    <case match="20" result="Vermont"/>
                    <case match="21" result="Arkansas"/>
                    <case match="22" result="Idaho"/>
                    <case match="23" result="Maryland"/>
                    <case match="24" result="DC"/>
                    <case match="25" result="New Jersey"/>
                    <case match="26" result="Pennsylvania"/>
                    <case match="27" result="Virginia"/>
                    <case match="28" result="California"/>
                    <case match="29" result="Illinois"/>
                    <case match="30" result="Massachusets"/>
                    <case match="31" result="New Mexico"/>
                    <case match="32" result="Rhode Island"/>
                    <case match="33" result="Washington"/>
                    <case match="34" result="Colorado"/>
                    <case match="35" result="Indiana"/>
                    <case match="36" result="Michigan"/>
                    <case match="37" result="Puerto Rico"/>
                    <case match="38" result="New York"/>
                    <case match="39" result="South Carolina"/>
                    <case match="40" result="West Virginia"/>
                    <case match="41" result="Connecticut"/>
                    <case match="42" result="Iowa"/>
                    <case match="43" result="Minnesota"/>
                    <case match="44" result="US Virgin Islands"/>
                    <case match="45" result="North Carolina"/>
                    <case match="46" result="South Dakota"/>
                    <case match="47" result="Wisconsin"/>
                    <case match="48" result="Delaware"/>
                    <case match="49" result="Kansas"/>
                    <case match="50" result="Mississippi"/>
                    <case match="51" result="Missouri"/>
                    <case match="52" result="Montana"/>
                    <case match="53" result="North Dakota"/>
                    <case match="54" result="Tennesee"/>
                    <case match="55" result="Wyoming"/>
                </switch>
            </replacements>
        </message>
    </action>
    <!-- timer -->
    <trigger action="round_tracker:=1" scope="match">
        <filter>
            <after duration="61s" filter="all(match-running,round_tracker=0)" />
        </filter>
    </trigger>
    <trigger scope="match">
        <filter>
            <after duration="1s" filter="round_tracker=1" />
        </filter>
        <action>
            <set var="round_tracker" value="0" />
            <set var="round_count" value="round_count + 1" />
            <kill-entities filter="dropped-item" />
        </action>
    </trigger>
</actions>
<kill-rewards>
    <kill-reward filter="hiders" kit="invis-kit"/>
</kill-rewards>
<disabledamage>
    <damage>fall</damage>
</disabledamage>
<gamerules>
    <doTileDrops>false</doTileDrops>
</gamerules>
<compass show-distance="true">
    <player filter="seekers" name="`3Closest Seeker"/>
</compass>
<hunger>
    <depletion>off</depletion>
</hunger>
<broadcasts>
    <tip filter="hiders" after="5s" every="2m11s">Your name tag won't be displayed to the Seekers, no need to shift!</tip>
    <alert after="25s">Seekers have been released!</alert>
    <alert after="35s">Every minute, some of the buildings will disappear!</alert>
</broadcasts>
</map>