<map proto="1.5.0">
<name>Skill Issue</name>
<version>2.0.1</version>
<objective>Capture the Wool in 2 minutes, or prevent the Rusher from doing so!</objective>
<created>2025-08-04</created>
<game>Rusher Roulette</game>
<phase>staging</phase>
<include id="countdown" />
<include id="void-death" />
<authors>
    <author uuid="64e840c8-4fb5-4659-a36b-ff93e2f6113a" /> <!-- Javg_ -->
</authors>
<constants>
    <constant id="void-plane">-1</constant>
    <constant id="ROUND_ABOUT_TO_START">0</constant>
    <constant id="ROUND_STARTED">1</constant>
    <constant id="ROUND_RUNNING">2</constant>
    <constant id="ROUND_FINISHED">3</constant>
    <constant id="ROUND_RESTARTING">4</constant>
    <constant id="ROUND_PREPARING">5</constant>
    <constant id="ROUNDS_AMOUNT">5</constant>
    <constant id="ROUND_DURATION_SECONDS">120</constant>
    <!-- PERK IDS -->
    <constant id="PERKS_AMOUNT">8</constant>
    <constant id="PERK_DOUBLE_HEALTH">1</constant>
    <constant id="PERK_TNT">2</constant>
    <constant id="PERK_SLOWNESS_DEFENDERS">3</constant>
    <constant id="PERK_SHARPNESS_SWORD">4</constant>
    <constant id="PERK_SPEED">5</constant>
    <constant id="PERK_JUMP_BOOST">6</constant>
    <constant id="PERK_POWER_BOW">7</constant>
    <constant id="PERK_ARMORLESS_DEFENDERS">8</constant>
    <constant id="LAST_ROUND_PERKS_AMOUNT">1</constant>
    <constant id="LAST_ROUND_PERK_NO_BOWS">1</constant>
</constants>
<teams>
    <team id="rusher" color="dark red" max="1" max-overfill="1">Rusher</team>
    <team id="defenders" color="blue" max="40" max-overfill="50" plural="true">Defenders</team>
</teams>
<kits>
    <kit id="rusher-kit">
        <item material="arrow" slot="28" />
        <item material="diamond pickaxe" slot="2" unbreakable="true">
            <enchantment level="2">efficiency</enchantment>
        </item>
        <item material="diamond axe" slot="3" unbreakable="true">
            <enchantment level="2">efficiency</enchantment>
        </item>
        <item material="diamond spade" slot="30" unbreakable="true">
            <enchantment level="2">efficiency</enchantment>
        </item>
        <item material="log 2" amount="64" damage="1" slot="4" />
        <item material="log 2" amount="64" damage="1" slot="31" />
        <item material="stained glass" amount="64" team-color="true" slot="5" />
        <item material="stained glass" amount="64" team-color="true" slot="32" />
        <item material="water bucket" slot="7" />
        <item material="water bucket" slot="34" />
        <item material="golden apple" amount="2" slot="8" />
        <helmet material="leather helmet" team-color="true" />
        <chestplate material="diamond chestplate" />
        <leggings material="iron leggings" />
        <boots material="diamond boots" />
        <action>
            <set var="is_rusher" value="1" />
            <set var="rusher_identifier" value="1" />
        </action>
    </kit>
    <kit id="defenders-kit">
        <item material="iron sword" slot="0" unbreakable="true" />
        <item material="diamond pickaxe" slot="2" unbreakable="true" />
        <item material="diamond axe" slot="3" unbreakable="true" />
        <item material="diamond spade" slot="30" unbreakable="true" />
        <item material="log" amount="64" damage="2" slot="4" />
        <item material="stained glass" amount="64" team-color="true" slot="5" />
        <item material="redstone block" amount="64" slot="6" />
        <item material="workbench" amount="64" slot="33" />
        <item material="iron fence" amount="64" slot="24" />
        <item material="bucket" slot="7" />
        <item material="golden apple" slot="8" />
    </kit>
    <kit id="armor-defenders-kit" filter="all(defenders,is_perk_active_armorless_defenders=0)">
        <helmet material="leather helmet" team-color="true" />
        <chestplate material="iron chestplate" />
        <leggings material="iron leggings" />
        <boots material="iron boots" />
    </kit>
    <kit id="bow-defenders-kit" filter="all(defenders,is_last_round_perk_active_no_bows=0)">
        <item material="bow" slot="1" unbreakable="true" />
        <item material="arrow" slot="28" amount="64" />
    </kit>
    <kit id="bow-rusher-kit" filter="all(rusher,is_perk_active_power_bow=0)">
        <item material="bow" slot="1" unbreakable="true">
            <enchantment>infinity</enchantment>
        </item>
    </kit>
    <kit id="sword-rusher-kit" filter="all(rusher,is_perk_active_sharpness_sword=0)">
        <item material="diamond sword" slot="0" unbreakable="true" />
    </kit>
    <kit id="team-switch-defenders-kit">
        <team-switch team="defenders" show-title="false" />
    </kit>
    <kit id="team-switch-rusher-kit">
        <team-switch team="rusher" show-title="false" />
    </kit>
    <!-- PERK KITS -->
    <kit id="health-boost-perk-kit" force="true" filter="all(rusher,is_perk_active_double_health=1)">
        <effect amplifier="5" duration="oo">health boost</effect>
        <effect amplifier="5" duration="5s">instant health</effect>
    </kit>
    <kit id="tnt-perk-kit" force="true" filter="all(rusher,is_perk_active_tnt=1)">
        <item material="tnt" amount="64" slot="6" />
        <item material="tnt" amount="64" slot="33" />
        <item material="redstone block" amount="16" slot="24" />
    </kit>
    <kit id="slowness-defenders-perk-kit" force="true" filter="all(defenders,is_perk_active_slowness_defenders=1)">
        <effect amplifier="2" duration="oo">slowness</effect>
    </kit>
    <kit id="sharpness-perk-kit" force="true" filter="all(rusher,is_perk_active_sharpness_sword=1)">
        <item material="diamond sword" slot="0" unbreakable="true">
            <enchantment level="4">sharpness</enchantment>
        </item>
    </kit>
    <kit id="speed-perk-kit" force="true" filter="all(rusher,is_perk_active_speed=1)">
        <effect amplifier="2" duration="oo">speed</effect>
    </kit>
    <kit id="jump-boost-perk-kit" force="true" filter="all(rusher,is_perk_active_jump_boost=1)">
        <effect amplifier="3" duration="oo">jump boost</effect>
    </kit>
    <kit id="power-bow-perk-kit" force="true" filter="all(rusher,is_perk_active_power_bow=1)">
        <item material="bow" slot="1" unbreakable="true">
            <enchantment>infinity</enchantment>
            <enchantment level="4">power</enchantment>
        </item>
    </kit>
    <!-- OTHER KITS -->
    <kit id="default-kit">
        <book show-other="false">
            <title>`e`lHow to Play</title>
            <author>Javg_</author>
            <pages>
                <page>
                    `2» `lRUSHER ROULETTE
                    `2» Overview`r

                    One player is chosen as the `4`lRusher`r and has `6`o2 minutes`r to capture the wool.

                    The rest are `9`lDefenders`r who must stop them.
                </page>
                <page>
                    `2» `lRUSHER ROULETTE
                    `2» Rounds`r

                    The game has `6`o5 rounds.`r

                    If a `4`lRusher`r captures the wool, they win.

                    If no one does after 5 rounds, the `9`lDefenders`r win.
                </page>
                <page>
                    `2» `lRUSHER ROULETTE
                    `2» Rotation`r

                    If the Rusher fails to capture, a `6`orandom player`r is selected to be the next `4`lRusher.`r

                    The map is `6reset`r after every round.
                </page>
                <page>
                    `2» `lRUSHER ROULETTE
                    `2» Perks`r

                    After each round, the next `4`lRusher`r gains a `a`operk`r that can give them a boost or make things harder for the `9`lDefenders`r.

                    Perks stack as the game goes on.
                </page>
            </pages>
        </book>
    </kit>
    <kit id="empty-kit" force="true">
        <clear/>
    </kit>
    <give kit="default-kit" filter="observing" />
    <give kit="defenders-kit">
        <filter>
            <after duration="0.5s" filter="all(round_state=${ROUND_ABOUT_TO_START},defenders,alive)" />
        </filter>
    </give>
    <give kit="bow-defenders-kit">
        <filter>
            <after duration="0.5s" filter="all(round_state=${ROUND_ABOUT_TO_START},defenders,alive,is_last_round_perk_active_no_bows=0)" />
        </filter>
    </give>
    <give kit="empty-kit" filter="all(any(round_state=${ROUND_FINISHED},round_state=${ROUND_RESTARTING}),not(current_round=${ROUNDS_AMOUNT}))" />
</kits>
<destroyables>
    <destroyable name="placeholder" owner="rusher" materials="obsidian" region="placeholder-monument" show-info="false" show-messages="false" show-sidebar="false" />
</destroyables>
<spawns>
    <player-kit>
        <kit id="health-boost-perk-kit" />
        <kit id="bow-defenders-kit" />
        <kit id="armor-defenders-kit" />
        <kit id="sword-rusher-kit" />
        <kit id="bow-rusher-kit" />
        <kit id="tnt-perk-kit" />
        <kit id="slowness-defenders-perk-kit" />
        <kit id="sharpness-perk-kit" />
        <kit id="speed-perk-kit" />
        <kit id="jump-boost-perk-kit" />
        <kit id="power-bow-perk-kit" />
    </player-kit>
    <default>
        <regions yaw="0">
            <point>0.5,40,0.5</point>
        </regions>
    </default>
    <spawn team="rusher" kit="rusher-kit">
        <region yaw="180">
            <point id="rusher-spawn">0.5,13,70.5</point>
        </region>
    </spawn>
    <spawn team="defenders" kit="defenders-kit">
        <region yaw="-90">
            <cuboid id="defenders-spawn-west" min="-37.5,7,-1.5" max="-34.5,7,1.5" />
        </region>
        <region yaw="90">
            <cuboid id="defenders-spawn-east" min="38.5,7,1.5" max="35.5,7,-1.5" />
        </region>
    </spawn>
</spawns>
<regions>
    <rectangle id="half-to-east" min="0.5,-41" max="oo,oo"/>
    <rectangle id="half-to-west" min="0.5,-41" max="-oo,oo"/>
    <union id="cages">
        <cuboid id="rusher-cage" min="-1,14,72" max="2,17,69" />
        <cuboid id="defenders-cage-west" min="-39,8,-3" max="-33,11,3" />
        <cuboid id="defenders-cage-east" min="40,8,3" max="34,11,-3" />
        <union id="sky-cages">
            <point id="rusher-sky-cage">0.5,36.5,0.5</point>
            <cuboid id="defenders-sky-cage-west" min="-38.5,36.5,-2.5" max="-33.5,36.5,2.5" />
            <cuboid id="defenders-sky-cage-east" min="39.5,36.5,2.5" max="34.5,36.5,-2.5" />
        </union>
    </union>
    <negative id="void-area">
        <complement id="wool-monument">
            <rectangle min="-11,-34" max="12,-52" />
            <block id="placeholder-monument">0.5,0,-45.5</block>
        </complement>
        <rectangle id="wool-room" min="12,34" max="-11,58" />
        <rectangle id="playable-area" min="-10,34" max="11,-34" />
        <union id="rusher-base">
            <rectangle min="2,67" max="-1,74" />
            <rectangle min="4,72" max="-3,69" />
        </union>
        <complement id="rusher-parkour">
            <rectangle min="11,51" max="-10,69" />
            <region id="rusher-base" />
        </complement>
        <union id="defenders-base">
            <rectangle id="defenders-base-west" min="-41,-5" max="-13,5" />
            <rectangle id="defenders-base-east" min="42,5" max="14,-5" />
        </union>
        <region id="placeholder-monument" />
    </negative>
    <union id="wool-spawners">
        <block id="wool-spawner-1">0.5,13,53.5</block>
        <block id="wool-spawner-2">-5.5,13,47.5</block>
        <block id="wool-spawner-3">0.5,13,41.5</block>
        <block id="wool-spawner-4">6.5,13,47.5</block>
    </union>
    <apply region="void-area" block="never" message="You may not build in the void!" />
    <apply region="rusher-base" block="never" message="You may not modify this area!" />
    <apply region="defenders-base" block="never" message="You may not modify this area!" />
    <apply region="sky-cages" block="never" message="You may not modify this area!" />
    <apply region="wool-monument" block="never" message="You may not modify this area!" />
    <apply region="wool-monument" enter="rusher" message="You may not enter the wool monument!" />
    <apply region="wool-room" enter="rusher" message="You may not enter the wool room!" />
    <apply region="wool-room" block-break="unbreakable-blocks-wool-room" message="You may not destroy these chests!" />
    <apply region="wool-room" block="rusher" message="You may not modify the wool room!" />
</regions>
<wools>
    <wool team="rusher" color="red" location="0.5,17,47.5">
        <monument>
            <block>0.5,17,-45.5</block>
        </monument>
    </wool>
</wools>
<spawners>
    <spawner spawn-region="wool-spawner-1" player-region="wool-room" max-entities="1" delay="2s">
        <item material="wool" damage="14" />
    </spawner>
    <spawner spawn-region="wool-spawner-2" player-region="wool-room" max-entities="1" delay="2s">
        <item material="wool" damage="14" />
    </spawner>
    <spawner spawn-region="wool-spawner-3" player-region="wool-room" max-entities="1" delay="2s">
        <item material="wool" damage="14" />
    </spawner>
    <spawner spawn-region="wool-spawner-4" player-region="wool-room" max-entities="1" delay="2s">
        <item material="wool" damage="14" />
    </spawner>
</spawners>
<portals>
    <portal forward="all(any(round_state=${ROUND_FINISHED},round_state=${ROUND_RESTARTING}),defenders,half-to-west,not(current_round=${ROUNDS_AMOUNT}))" yaw="@-90" pitch="@0" destination="defenders-sky-cage-west" sound="false" />
    <portal forward="all(any(round_state=${ROUND_FINISHED},round_state=${ROUND_RESTARTING}),defenders,half-to-east,not(current_round=${ROUNDS_AMOUNT}))" yaw="@90" pitch="@0" destination="defenders-sky-cage-east" sound="false" />
    <portal forward="all(any(round_state=${ROUND_FINISHED},round_state=${ROUND_RESTARTING}),rusher,not(current_round=${ROUNDS_AMOUNT}))" yaw="@180" pitch="@0" destination="rusher-sky-cage" sound="false" />
    <portal forward="all(round_state=${ROUND_ABOUT_TO_START},defenders,half-to-west)" yaw="@-90" pitch="@0" destination="defenders-spawn-west" sound="false" />
    <portal forward="all(round_state=${ROUND_ABOUT_TO_START},defenders,half-to-east)" yaw="@90" pitch="@0" destination="defenders-spawn-east" sound="false" />
    <portal forward="all(round_state=${ROUND_ABOUT_TO_START},rusher)" yaw="@180" pitch="@0" destination="rusher-spawn" sound="false" />
</portals>
<respawn delay="0" auto="true" />
<structures>
    <structure id="map" air="true" clear="false">
        <region>
            <cuboid min="-41,0,74" max="42,30,-52" />
        </region>
    </structure>
    <dynamic structure="map">
        <trigger>
            <after duration="3s" filter="all(any(round_state=${ROUND_FINISHED},round_state=${ROUND_RESTARTING}),not(current_round=${ROUNDS_AMOUNT}))" />
        </trigger>
    </dynamic>
</structures>
<variables scope="match">
    <variable id="players" />
    <variable id="is_rusher" scope="player" />
    <variable id="tmp_rusher" scope="player" />
    <variable id="tmp_rusher_min" />
    <variable id="rusher_identifier" scope="player" exclusive="1" />
    <variable id="round_state" default="-1" />
    <variable id="rounds_completed" />
    <variable id="current_round" />
    <variable id="rusher_checking_timer" />
    <variable id="next_round" default="1" />
    <variable id="countdown_is_on" />
    <variable id="rusher_online_before_round_starts" />
    <variable id="round_must_not_finish" />
    <!-- PERKS -->
    <variable id="is_perk_active_double_health" />
    <variable id="is_perk_active_tnt" />
    <variable id="is_perk_active_slowness_defenders" />
    <variable id="is_perk_active_sharpness_sword" />
    <variable id="is_perk_active_speed" />
    <variable id="is_perk_active_jump_boost" />
    <variable id="is_perk_active_power_bow" />
    <variable id="is_perk_active_armorless_defenders" />
    <!-- LAST ROUND PERKS -->
    <variable id="is_last_round_perk_active_no_bows" />
    <!-- RANDOM SEEDS -->
    <variable id="i" />
    <array id="already_selected_perks" size="${ROUNDS_AMOUNT}" />
    <variable id="selected_perk_id" />
    <variable id="selected_last_round_perk_id" />
    <variable id="perk_just_selected" />
    <variable id="duplicate_perk_found" />
    <variable id="should_select_perk" />
    <variable id="messages_seed" />
    <variable id="tmp_perk_id" />
    <variable id="calc" />
</variables>
<filters>
    <deny id="unbreakable-blocks-wool-room">
        <material>chest</material>
    </deny>
    <all id="round-should-finish">
        <not>
            <countdown id="countdown-started" duration="${ROUND_DURATION_SECONDS}s" message="Round over in {0}">
                <all>
                    <variable var="round_state">${ROUND_RUNNING}</variable>
                    <match-running />
                </all>
            </countdown>
        </not>
        <variable var="round_must_not_finish">0</variable>
        <match-running />
        <variable var="countdown_is_on">1</variable>
    </all>
    <variable id="next-round-should-be-last" var="next_round">${ROUNDS_AMOUNT}</variable>
    <any id="entities-to-remove">
        <entity>dropped item</entity>
        <entity>boat</entity>
    </any>
    <time id="first-start">0.05s</time>
    <after id="round-should-prepare" duration="5s" filter="all(round_state=${ROUND_FINISHED},match-running)" />
    <any id="round-should-start">
        <after duration="3s" filter="perk_just_selected=1" />
        <after duration="5s" filter="round_state=${ROUND_RESTARTING}" />
    </any>
    <after id="round-started" duration="10.6s" filter="round_state=${ROUND_ABOUT_TO_START}" />
    <after id="countdown-start" duration="7.5s" filter="all(round_state=${ROUND_ABOUT_TO_START},match-running)" /> <!-- INCLUDE COUNTDOWN FILTER -->
</filters>
<actions>
    <!-- PICK NEXT RUSHER FROM DEFENDERS -->
    <action id="pick-next-rusher" scope="match">
        <set var="players" value="0" />
        <switch-scope inner="player" filter="participating">
            <set var="is_rusher" value="0" />
        </switch-scope>
        <switch-scope inner="player" filter="all(participating,defenders,alive)">
            <set var="players" value="players + 1" />
            <set var="tmp_rusher" value="random()" />
        </switch-scope>
        <set var="tmp_rusher_min" value="99" />
        <switch-scope inner="player" filter="all(participating,defenders)">
            <set var="tmp_rusher_min" value="min(tmp_rusher, tmp_rusher_min)" />
        </switch-scope>
        <switch-scope inner="player" filter="all(participating,defenders)">
            <set var="tmp_rusher" value="tmp_rusher - tmp_rusher_min" />
            <action filter="tmp_rusher=0">
                <set var="tmp_rusher" value="99" />
                <set var="is_rusher" value="1" />
                <set var="rusher_identifier" value="1" />
            </action>
        </switch-scope>
    </action>
    <!-- PREPARING NEXT ROUND (MATCH) -->
    <trigger scope="match" filter="round_state=${ROUND_PREPARING}">
        <action>
            <action id="pick-next-rusher" />
        </action>
    </trigger>
    <!-- ROUND IS ABOUT TO START (MATCH) -->
    <trigger filter="round_state=${ROUND_ABOUT_TO_START}" scope="match">
        <action>
            <set var="rusher_checking_timer" value="0" />
            <switch-scope outer="match" inner="player" filter="participating">
                <action filter="is_rusher=0">
                    <kit id="team-switch-defenders-kit" />
                </action>
                <action filter="is_rusher=1">
                    <kit id="team-switch-rusher-kit" />
                </action>
            </switch-scope>
        </action>
    </trigger>
    <!-- ROUND IS RUNNING (MATCH) -->
    <trigger filter="round_state=${ROUND_RUNNING}" scope="match">
        <action>
            <fill region="cages" material="air" />
            <set var="round_must_not_finish" value="0" />
            <set var="current_round" value="current_round+1" />
            <set var="perk_just_selected" value="0" />
        </action>
    </trigger>
    <!-- ROUND HAS FINISHED (MATCH) -->
    <trigger filter="all(round_state=${ROUND_FINISHED},not(current_round=${ROUNDS_AMOUNT}))" scope="match">
        <action>
            <kill-entities filter="entities-to-remove" />
            <set var="countdown_is_on" value="0" />
            <set var="next_round" value="rounds_completed+2" />
            <set var="rounds_completed" value="rounds_completed+1" />
            <set var="rusher_online_before_round_starts" value="0" />
        </action>
    </trigger>
    <!-- ROUND RESTARTING (MATCH) -->
    <trigger filter="round_state=${ROUND_RESTARTING}" scope="match">
        <action>
            <kill-entities filter="entities-to-remove" />
            <set var="rusher_online_before_round_starts" value="0" />
            <set var="current_round" value="current_round-1" />
        </action>
    </trigger>
    <!-- ROUND RESTARTING (MATCH) [SAFETY DELAY] -->
    <trigger scope="match">
        <filter>
            <after duration="0.5s" filter="round_state=${ROUND_RESTARTING}" />
        </filter>
        <action id="pick-next-rusher" />
    </trigger>
    <!-- LAST ROUND HAS FINISHED (MATCH) -->
    <trigger filter="all(round_state=${ROUND_FINISHED},current_round=${ROUNDS_AMOUNT})" scope="match">
        <action>
            <fill region="placeholder-monument" material="air" events="true" /> <!-- DEFENDERS WIN -->
        </action>
    </trigger>
    <!-- CHECK IF RUSHER LEFT THE MATCH -->
    <trigger scope="match">
        <filter>
            <all>
                <pulse period="1s" duration="0.5s" filter="round_state=${ROUND_RUNNING}" />
                <match-running />
            </all>
        </filter>
        <action>
            <set var="rusher_checking_timer" value="rusher_checking_timer+1" />
        </action>
    </trigger>
    <trigger scope="player">
        <filter>
            <all>
                <pulse period="1s" duration="0.5s" filter="any(round_state=${ROUND_RUNNING})" />
                <variable var="is_rusher">1</variable>
                <team>rusher</team>
            </all>
        </filter>
        <action>
            <switch-scope inner="match">
                <set var="rusher_checking_timer" value="0" />
            </switch-scope>
        </action>
    </trigger>
    <trigger filter="rusher_checking_timer=3.." scope="match">
        <action>
            <switch-scope inner="match">
                <set var="round_state" value="${ROUND_RESTARTING}" /> <!-- RUSHER LEFT - RESTART ROUND -->
                <set var="round_must_not_finish" value="1" /> <!-- PREVENT ROUND FROM CHANGING STATE -->
            </switch-scope>
        </action>
    </trigger>
    <!-- CHECK IF RUSHER IS WHILE ABOUT TO START (MATCH) -->
    <trigger scope="player">
        <filter>
            <after duration="0.5s" filter="all(round_state=${ROUND_ABOUT_TO_START},is_rusher=1)" />
        </filter>
        <action>
            <switch-scope inner="match">
                <set var="rusher_online_before_round_starts" value="1" />
            </switch-scope>
        </action>
    </trigger>
    <!-- VARIABLE TRIGGERS -->
    <trigger filter="round-started" scope="match">
        <action>
            <set var="round_state" value="${ROUND_RUNNING}" />
        </action>
    </trigger>
    <trigger filter="first-start" scope="match">
        <action>
            <set var="round_state" value="${ROUND_ABOUT_TO_START}" />
        </action>
    </trigger>
    <trigger filter="round-should-prepare" scope="match">
        <action>
            <set var="round_state" value="${ROUND_PREPARING}" />
        </action>
    </trigger>
    <trigger filter="round-should-start" scope="match">
        <action>
            <set var="round_state" value="${ROUND_ABOUT_TO_START}" />
        </action>
    </trigger>
    <trigger filter="round-should-finish" scope="match">
        <action>
            <set var="round_state" value="${ROUND_FINISHED}" />
        </action>
    </trigger>
    <trigger filter="countdown-started" scope="match">
        <action>
            <set var="countdown_is_on" value="1" />
        </action>
    </trigger>
    <!-- MESSAGES -->
    <!-- PREPARING NEXT ROUND (MATCH) [RANDOMIZED] -->
    <trigger scope="match" filter="all(round_state=${ROUND_PREPARING},messages_seed=1..50)">
        <action>
            <message title="Seems harder than expected..." subtitle="What if we give the next rusher a little `e`ogift`r?" />
        </action>
    </trigger>
    <trigger scope="match" filter="all(round_state=${ROUND_PREPARING},messages_seed=51..)">
        <action>
            <message title="Let's forget that happened" subtitle="Here's a little `e`otreat`r for the next" />
        </action>
    </trigger>
    <trigger scope="match">
        <filter>
            <after duration="4s" filter="round_state=${ROUND_PREPARING}" />
        </filter>
        <action>
            <message title="Let's see what we get" subtitle="Their perk is: `e`kXXXXXXXXXXXXXXXXXXXX" stay="10s" />
        </action>
    </trigger>
    <!-- ROUND IS ABOUT TO START (MATCH) [SAFETY DELAY] -->
    <trigger scope="match">
        <filter>
            <after duration="0.8s" filter="all(round_state=${ROUND_ABOUT_TO_START})" />
        </filter>
        <action>
            <message text="Round `e{current}/{total}`r starting soon...">
                <replacements>
                    <decimal id="current" value="next_round" />
                    <decimal id="total" value="${ROUNDS_AMOUNT}" />
                </replacements>
            </message>
        </action>
    </trigger>
    <!-- ROUND IS ABOUT TO START (RUSHER) [SAFETY DELAY] -->
    <trigger scope="team">
        <filter>
            <after duration="0.8s" filter="all(round_state=${ROUND_ABOUT_TO_START},rusher)" />
        </filter>
        <action>
            <message title="Round `e{current}/{total}`r starting soon..." subtitle="You're the `4`lRusher`r. Capture the wool `obefore`r the round ends!" stay="4.2s">
                <replacements>
                    <decimal id="current" value="next_round" />
                    <decimal id="total" value="${ROUNDS_AMOUNT}" />
                </replacements>
            </message>
        </action>
    </trigger>
    <!-- ROUND IS ABOUT TO START (DEFENDERS) [RUSHER ONLINE] [SAFETY DELAY] -->
    <trigger scope="team">
        <filter>
            <after duration="0.8s" filter="all(round_state=${ROUND_ABOUT_TO_START},defenders,rusher_online_before_round_starts=1)" />
        </filter>
        <action>
            <message title="Round `e{current}/{total}`r starting soon..." subtitle="You're a `9`lDefender`r. Prevent {player} from capturing the wool!" stay="4.2s">
                <replacements>
                    <decimal id="current" value="next_round" />
                    <decimal id="total" value="${ROUNDS_AMOUNT}" />
                    <player id="player" var="rusher_identifier" fallback="the Rusher" />
                </replacements>
            </message>
        </action>
    </trigger>
    <!-- ROUND IS ABOUT TO START (DEFENDERS) [RUSHER LEFT] [SAFETY DELAY] -->
    <trigger scope="team">
        <filter>
            <after duration="0.8s" filter="all(round_state=${ROUND_ABOUT_TO_START},defenders,rusher_online_before_round_starts=0)" />
        </filter>
        <action>
            <message title="Round `e{current}/{total}`r starting soon..." subtitle="You're a `9`lDefender`r. Prevent the `4Rusher`r from capturing the wool!" stay="4.2s">
                <replacements>
                    <decimal id="current" value="next_round" />
                    <decimal id="total" value="${ROUNDS_AMOUNT}" />
                </replacements>
            </message>
        </action>
    </trigger>
    <!-- ROUND RESTARTING (MATCH) -->
    <trigger filter="all(round_state=${ROUND_RESTARTING},messages_seed=1..50)" scope="match">
        <action>
            <message title="{player} just gave up ☠" subtitle="`4`lRusher`r left. Round `erestarting`r soon..." stay="3s">
                <replacements>
                    <player id="player" var="rusher_identifier" fallback="This player" />
                </replacements>
            </message>
        </action>
    </trigger>
    <trigger filter="all(round_state=${ROUND_RESTARTING},messages_seed=51..)" scope="match">
        <action>
            <message title="{player} alt+F4’d lol" subtitle="`4`lRusher`r left. Round `erestarting`r soon..." stay="3s">
                <replacements>
                    <player id="player" var="rusher_identifier" fallback="This player" />
                </replacements>
            </message>
        </action>
    </trigger>
    <!-- ROUND HAS FINISHED (MATCH) [RANDOMIZED] -->
    <trigger filter="all(round_state=${ROUND_FINISHED},not(current_round=${ROUNDS_AMOUNT}),messages_seed=1..20)" scope="match">
        <action>
            <message subtitle="{player}'s not that good then..." stay="4s">
                <replacements>
                    <player id="player" var="rusher_identifier" fallback="This player" />
                </replacements>
            </message>
        </action>
    </trigger>
    <trigger filter="all(round_state=${ROUND_FINISHED},not(current_round=${ROUNDS_AMOUNT}),messages_seed=21..40)" scope="match">
        <action>
            <message subtitle="It looks like {player} loves long matches..." stay="4s">
                <replacements>
                    <player id="player" var="rusher_identifier" fallback="This player" />
                </replacements>
            </message>
        </action>
    </trigger>
    <trigger filter="all(round_state=${ROUND_FINISHED},not(current_round=${ROUNDS_AMOUNT}),messages_seed=41..60)" scope="match">
        <action>
            <message subtitle="{player} had one job" stay="4s">
                <replacements>
                    <player id="player" var="rusher_identifier" fallback="This player" />
                </replacements>
            </message>
        </action>
    </trigger>
    <trigger filter="all(round_state=${ROUND_FINISHED},not(current_round=${ROUNDS_AMOUNT}),messages_seed=61..80)" scope="match">
        <action>
            <message subtitle="That’s one way to make the match longer, {player}" stay="4s">
                <replacements>
                    <player id="player" var="rusher_identifier" fallback="This player" />
                </replacements>
            </message>
        </action>
    </trigger>
    <trigger filter="all(round_state=${ROUND_FINISHED},not(current_round=${ROUNDS_AMOUNT}),messages_seed=81..)" scope="match">
        <action>
            <message subtitle="Not even lag could excuse that one, {player}" stay="4s">
                <replacements>
                    <player id="player" var="rusher_identifier" fallback="This player" />
                </replacements>
            </message>
        </action>
    </trigger>
    <!-- SOUNDS -->
    <!-- PREPARING NEXT ROUND [SAFETY DELAY] -->
    <trigger scope="match">
        <filter>
            <after duration="0.01s" filter="round_state=${ROUND_PREPARING}" />
        </filter>
        <action>
            <sound key="random.click" />
        </action>
    </trigger>
    <trigger scope="match">
        <filter>
            <after duration="4.01s" filter="round_state=${ROUND_PREPARING}" />
        </filter>
        <action>
            <sound key="random.click" />
        </action>
    </trigger>
    <trigger scope="match">
        <filter>
            <after duration="0.01s" filter="perk_just_selected=1" />
        </filter>
        <action>
            <sound key="random.levelup" />
        </action>
    </trigger>
    <!-- ROUND IS ABOUT TO START [SAFETY DELAY] -->
    <trigger scope="match">
        <filter>
            <after duration="0.8s" filter="round_state=${ROUND_ABOUT_TO_START}" />
        </filter>
        <action>
            <sound key="entity.skeleton_horse.death" />
        </action>
    </trigger>
    <!-- ROUND RESTARTING [SAFETY DELAY] -->
    <trigger scope="match">
        <filter>
            <after duration="0.01s" filter="round_state=${ROUND_RESTARTING}" />
        </filter>
        <action>
            <sound key="mob.villager.no" />
        </action>
    </trigger>
    <!-- ROUND FINISHED [SAFETY DELAY] -->
    <trigger scope="match">
        <filter>
            <after duration="0.01s" filter="round_state=${ROUND_FINISHED}" />
        </filter>
        <action>
            <sound key="${entity.blaze.death}" />
        </action>
    </trigger>
    <!-- PERKS -->
    <!-- DOUBLE HEALTH -->
    <trigger scope="match" filter="selected_perk_id=${PERK_DOUBLE_HEALTH}">
        <action>
            <set var="is_perk_active_double_health" value="1" />
            <message title="Let's see what we get" subtitle="Their perk is: `aDouble Health!" stay="2s" />
        </action>
    </trigger>
    <!-- TNT -->
    <trigger scope="match" filter="selected_perk_id=${PERK_TNT}">
        <action>
            <set var="is_perk_active_tnt" value="1" />
            <message title="Let's see what we get" subtitle="Their perk is: `aTNT Supply!" stay="2s" />
        </action>
    </trigger>
    <!-- SLOWNESS DEFENDERS -->
    <trigger scope="match" filter="selected_perk_id=${PERK_SLOWNESS_DEFENDERS}">
        <action>
            <set var="is_perk_active_slowness_defenders" value="1" />
            <message title="Let's see what we get" subtitle="Their perk is: `aSlowness II for Defenders!" stay="2s" />
        </action>
    </trigger>
    <!-- SHARP 4 SWORD -->
    <trigger scope="match" filter="selected_perk_id=${PERK_SHARPNESS_SWORD}">
        <action>
            <set var="is_perk_active_sharpness_sword" value="1" />
            <message title="Let's see what we get" subtitle="Their perk is: `aSharpness IV Sword!" stay="2s" />
        </action>
    </trigger>
    <!-- SPEED II -->
    <trigger scope="match" filter="selected_perk_id=${PERK_SPEED}">
        <action>
            <set var="is_perk_active_speed" value="1" />
            <message title="Let's see what we get" subtitle="Their perk is: `aSpeed II!" stay="2s" />
        </action>
    </trigger>
    <!-- JUMP BOOST III -->
    <trigger scope="match" filter="selected_perk_id=${PERK_JUMP_BOOST}">
        <action>
            <set var="is_perk_active_jump_boost" value="1" />
            <message title="Let's see what we get" subtitle="Their perk is: `aJump Boost III!" stay="2s" />
        </action>
    </trigger>
    <!-- POWER 4 BOW -->
    <trigger scope="match" filter="selected_perk_id=${PERK_POWER_BOW}">
        <action>
            <set var="is_perk_active_power_bow" value="1" />
            <message title="Let's see what we get" subtitle="Their perk is: `aPower IV Bow!" stay="2s" />
        </action>
    </trigger>
    <!-- ARMORLESS DEFENDERS -->
    <trigger scope="match" filter="selected_perk_id=${PERK_ARMORLESS_DEFENDERS}">
        <action>
            <set var="is_perk_active_armorless_defenders" value="1" />
            <message title="Let's see what we get" subtitle="Their perk is: `aNo armor for Defenders!" stay="2s" />
        </action>
    </trigger>
    <!-- LAST ROUND RUSHER PERKS -->
    <!-- BOWLESS DEFENDERS -->
    <trigger scope="match" filter="selected_last_round_perk_id=${LAST_ROUND_PERK_NO_BOWS}">
        <action>
            <set var="is_last_round_perk_active_no_bows" value="1" />
            <message title="Let's see what we get" subtitle="Their perk is: `aNo bows for defenders!" stay="2s" />
        </action>
    </trigger>
    <!-- RANDOMIZERS -->
    <!-- PERKS -->
    <trigger scope="match">
        <filter>
            <after duration="6s" filter="round_state=${ROUND_PREPARING}" />
        </filter>
        <action>
            <set var="should_select_perk" value="1" />
        </action>
    </trigger>
    <trigger scope="match">
        <filter>
            <pulse period="0.5s" duration="0.1s" filter="all(should_select_perk=1,not(next_round=${ROUNDS_AMOUNT}))" />
        </filter>
        <action>
            <set var="tmp_perk_id" value="floor(random() * ${PERKS_AMOUNT}) + 1" />
            <set var="i" value="0" />
            <set var="duplicate_perk_found" value="0" />
            <repeat times="${ROUNDS_AMOUNT}">
                <set var="calc" value="already_selected_perks[i] - tmp_perk_id" />
                <action filter="calc=0">
                    <set var="duplicate_perk_found" value="1" />
                </action>
                <set var="i" value="i + 1" />
            </repeat>
            <action filter="duplicate_perk_found=0">
                <set var="selected_perk_id" value="tmp_perk_id" />
                <set var="should_select_perk" value="0" />
                <set var="perk_just_selected" value="1" />
                <set var="i" value="0" />
                <repeat times="${ROUNDS_AMOUNT}">
                    <set var="calc" value="already_selected_perks[i]" />
                    <action filter="calc=0">
                        <set var="already_selected_perks" index="i" value="tmp_perk_id" />
                        <set var="tmp_perk_id" value="0" />
                    </action>
                    <set var="i" value="i + 1" />
                </repeat>
            </action>
        </action>
    </trigger>
    <!-- LAST ROUND PERKS -->
    <trigger scope="match">
        <filter>
            <pulse period="0.5s" duration="0.1s" filter="all(should_select_perk=1,next_round=${ROUNDS_AMOUNT})" />
        </filter>
        <action>
            <set var="selected_last_round_perk_id" value="floor(random() * ${LAST_ROUND_PERKS_AMOUNT}) + 1" />
            <set var="perk_just_selected" value="1" />
            <set var="should_select_perk" value="0" />
        </action>
    </trigger>
    <!-- MESSAGES -->
    <trigger scope="match" filter="round_state=${ROUND_ABOUT_TO_START}">
        <action>
            <set var="messages_seed" value="floor(random() * 100) + 1" />
        </action>
    </trigger>
    <!-- LOGGER (DEBUG ONLY) -->
    <!-- <trigger scope="match">
        <filter>
            <pulse period="1s" duration="0.5s"  filter="always" />
        </filter>
        <action>
            <message text="round_state {r}">
                <replacements>
                    <decimal id="r" value="round_state" />
                </replacements>
            </message>
            <message text="current_round {r}">
                <replacements>
                    <decimal id="r" value="current_round" />
                </replacements>
            </message>
        </action>
    </trigger> -->
</actions>
<itemremove>
    <item>seeds</item>
    <item>red rose</item>
    <item>yellow flower</item>
    <item>flower pot</item>
    <item>string</item>
    <item>prismarine</item>
    <item>redstone torch on</item>
    <item>redstone</item>
    <item>redstone wire</item>
    <item>beacon</item>
    <item>sign</item>
    <item>carpet</item>
    <item>dark oak fence</item>
    <item>diamond sword</item>
    <item>iron sword</item>
    <item>diamond pickaxe</item>
    <item>diamond axe</item>
    <item>diamond spade</item>
    <item>bow</item>
    <item>leather helmet</item>
    <item>iron chestplate</item>
    <item>iron leggings</item>
    <item>iron boots</item>
    <item>diamond chestplate</item>
    <item>diamond boots</item>
    <item>sponge</item>
    <item>iron fence</item>
    <item>workbench</item>
    <item>stained glass</item>
    <item>redstone block</item>
    <item>bucket</item>
    <item>water bucket</item>
    <item>wood button</item>
    <item>wood plate</item>
    <item>ladder</item>
    <item>wood step</item>
    <item>birch fence gate</item>
    <item>birch fence</item>
</itemremove>
<hunger>
    <depletion>off</depletion>
</hunger>
<maxbuildheight>30</maxbuildheight>
</map>
